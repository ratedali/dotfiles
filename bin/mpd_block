#!/bin/sh

#         DO WHAT THE FUCK YOU WANT TO PUBLIC LICENSE
#                 Version 2, December 2004
#
# Copyright 2016 yourname
#
# Everyone is permitted to copy and distribute verbatim or modified
# copies of this license document, and changing it is allowed as long
# as the name is changed.
#
#         DO WHAT THE FUCK YOU WANT TO PUBLIC LICENSE
# TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION
#
#  0. You just DO WHAT THE FUCK YOU WANT TO.


. "$HOME/.cache/wal/colors.sh"

format="%title% - %album%"

fa_playing=""
fa_paused=""
fa_stopped=""

playing_color="$color4"
paused_color="$color2"
stopped_color="$color1"


host="$BLOCK_INSTANCE"
if [[ -z "$host" ]]; then
    host="localhost"
fi

if [[ -n "$BLOCK_BUTTON"  ]]; then
    if [[ "$BLOCK_BUTTON" == "1" ]]; then
        mpc toggle --host "$host" > /dev/null 2>&1
    elif [[ "$BLOCK_BUTTON" == "2" ]]; then
        mpc prev --host "$host" > /dev/null 2>&1
    elif [[ "$BLOCK_BUTTON" == "3" ]]; then
        mpc next --host "$host" > /dev/null 2>&1
    fi
fi
status=$(mpc -f "$format" --host "$host" | head -n 2)
len=$(echo "$status" | wc -l)

if [[ $len -lt 2 ]]; then
    echo "$fa_stopped Nothing playing"
    echo
    echo "$stopped_color"
    exit 0
fi

current=$(echo "$status" | head -n1)
play_status=$(echo "$status" | tail -n1 | sed -re 's/^\[(.*)\].*$/\1/')

if [[ "$play_status" == "playing" ]]; then
    icon="$fa_playing"
    color="$playing_color"
else
    icon="$fa_paused"
    color="$paused_color"
fi

echo "$icon $current"
echo
echo "$color"
exit 0
