#!/bin/sh

#         DO WHAT THE FUCK YOU WANT TO PUBLIC LICENSE
#                 Version 2, December 2004
#
# Copyright 2016 yourname
#
# Everyone is permitted to copy and distribute verbatim or modified
# copies of this license document, and changing it is allowed as long
# as the name is changed.
#
#         DO WHAT THE FUCK YOU WANT TO PUBLIC LICENSE
# TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION
#
#  0. You just DO WHAT THE FUCK YOU WANT TO.


fa_playing=""
fa_paused=""
fa_stopped=""
playing_color="#0A9DFF"
paused_color="#FD971F"
stopped_color="#ff0000"

host="$BLOCK_INSTANCE"
if [[ -z "$host" ]]; then
    host="localhost"
fi

status=$(mpc --host "$host" | head -n 2)
len=$(echo "$status" | wc -l)

if [[ len -lt 2 ]]; then
    echo "$fa_stopped Nothing playing"
    echo
    echo "$stopped_color"
    exit 0
fi

current=$(echo "$status" | head -n1)
play_status=$(echo "$status" | tail -n1 | sed -re 's/^\[(.*)\].*$/\1/')

if [[ -n "$BLOCK_BUTTON" && "$BLOCK_BUTTON" == "1" ]]; then
    mpc toggle --host "$host" > /dev/null 2>&1
    if [[ "$play_status" == "playing" ]]; then
        icon="$fa_paused"
        color="$paused_color"
    else
        icon="$fa_playing"
        color="$playing_color"
    fi
else
    if [[ "$play_status" == "playing" ]]; then
        icon="$fa_playing"
        color="$playing_color"
    else
        icon="$fa_paused"
        color="$paused_color"
    fi
fi

echo "$icon $current"
echo
echo "$color"
exit 0
